<div id="admin-edit-vendor" class="admin" v-cloak>

  <%- partial('../../partials/admin-navbar.ejs') %>

  <div class="container">

    <div class="mb-3">
      <h1>{{vendor.name}}</h1>
      <h2 class="small">{{vendor.description}}</h2>
    </div>
    
    <ajax-form :form-data="vendor" :syncing.sync="syncing" :form-rules="formRules" :form-errors.sync="formErrors" :cloud-error.sync="cloudError" @submitted="vendorSubmitted" :action="(vendor.id) ?  'editVendor' : 'createVendor'">
      <div class="form-group">
        <label for="vendorName">Vendor Name</label>
        <input type="text" :class="{ 'is-invalid': formErrors.name }" v-model="vendor.name" class="form-control" id="vendorName">
      </div>
      <div class="form-group">
        <label for="vendorDescription">Vendor Description</label>
        <textarea type="text" class="form-control" rows="3" :class="{ 'is-invalid': formErrors.description }" v-model="vendor.description" id="vendorDescription" ></textarea>
      </div>
      <div class="form-group">
        <label for="vendorWallet">Vendor Wallet Address</label>
        <input type="text" :class="{ 'is-invalid': formErrors.walletId }" v-model="vendor.walletId" class="form-control text-monospace" id="vendorWallet" >
      </div>
      <div class="form-group">
        <label for="phoneNumber">Vendor Phone Number</label>
        <input type="text" :class="{ 'is-invalid': formErrors.phoneNumber }" v-model="vendor.phoneNumber" class="form-control" id="phoneNumber" >
      </div>
      <div class="form-group">
        <label for="vendorWallet">Delivery Restriction Details</label>
        <input type="text" placeholder="Delivers to L1, L2, L3" :class="{ 'is-invalid': formErrors.deliveryRestrictionDetails }" v-model="vendor.deliveryRestrictionDetails" class="form-control" id="vendorWallet" >
      </div>
      <div class="form-group">
        <label for="vendorType">Vendor Type</label>
        <select class="form-control" id="vendorType" v-model="vendor.type" :disabled="vendor.id">
          <option value="restaurant">Restaurant</option>
          <option value="shop" disabled>Shop</option>
        </select>
      </div>
      <div class="form-group">
        <label for="status">Status</label>
        <select class="form-control" id="status" v-model="vendor.status" >
          <option value="draft">Draft</option>
          <option value="inactive">Inactive</option>
          <option value="active">Active</option>
        </select>
      </div>

      <fieldset>
        <h2 class="h5 mt-3">Featured Image</h2>
        <img v-if="previewImageSrc || vendor.id" :src="(previewImageSrc) ? previewImageSrc : '/vendors/download-image/' + vendor.id" />
        <div class="custom-file">
          <input type="file" class="custom-file-input" accept="image/*" id="customFile" @change="changeVendorImageInput($event.target.files)">
          <label class="custom-file-label" for="customFile">{{imageName}}</label>
        </div>
      </fieldset>

      <ajax-button class="btn btn-peepl mt-4" type="submit" :syncing="syncing" v-bind:class="{ 'is-loading': syncing }">Save changes</ajax-button>
      <div v-if="cloudError === 'notFound'" class="alert alert-danger mt-4" role="alert">
        Vendor not found.
      </div>
      <div v-else-if="cloudError" class="alert alert-danger mt-4" role="alert">
        There has been an error updating the vendor. Please try again.
      </div>
    </ajax-form>

    <fieldset v-if="vendor.id">
      <h2 class="h5 mt-5">Products</h2>

      <edit-product v-for="product in vendor.products" :product="product" :vendorid="vendor.id">
      </edit-product>

      <div class="d-md-flex my-3 action-card-actions">
        <select class="form-control form-control-sm mr-3">
          <option value="true">Set as available</option>
          <option value="false">Set as unavailable</option>
        </select>
        <br/>
        <button @click="clickModifyProducts" class="btn btn-peepl btn-sm">Apply</button>
        <button class="btn btn-peepl btn-sm ml-auto">Add a new product</button>
      </div>
    </fieldset>

  </div>
</div>
<%- /* Expose server-rendered data as window.SAILS_LOCALS :: */ exposeLocalsToBrowser() %>
